# AI辅助阅读功能使用指南

## 功能概述

Lue电子书阅读器现在集成了AI辅助阅读功能，使用Google Gemini API为您提供智能的阅读理解和分析支持。

## 环境配置

### 1. 安装依赖
```bash
pip install google-generativeai>=0.8.0
```

### 2. 设置API密钥
获取Google Gemini API密钥并设置环境变量：
```bash
export GEMINI_API_KEY="your_api_key_here"
```

## 使用方法

### 启动AI助手
- 在阅读界面按 `?` 键打开AI助手全屏界面

### AI助手界面功能

#### 上下文显示
- 自动显示当前高亮句子和章节信息
- 为AI提供准确的阅读上下文

#### 对话功能
- **输入问题**：直接输入文字提问
- **发送消息**：按 `Enter` 键发送问题给AI
- **清空输入**：按 `Ctrl+U` 清空当前输入
- **关闭助手**：按 `Esc` 或 `?` 键关闭AI助手

#### 建议问题
首次打开AI助手时，会显示一些建议问题：
- "这句话是什么意思？"
- "这段内容的主要观点是什么？"
- "这里有什么深层含义吗？"

### 交互流程
1. 按 `?` 键打开AI助手
2. 查看当前阅读上下文
3. 输入您的问题
4. 按 `Enter` 发送问题
5. 等待AI回答
6. 可以继续追问或按 `Esc` 关闭

## 功能特点

### 智能上下文理解
- 自动获取当前句子和段落
- 提供章节标题信息
- 基于具体文本内容回答问题

### 全屏对话体验
- 专注的AI交互界面
- 支持多轮对话
- 保留对话历史记录

### 无缝集成
- 与现有阅读功能完美结合
- 不影响正常的阅读和TTS功能
- 遵循现有的UI设计风格

## 故障排除

### AI助手无法初始化
- 检查 `GEMINI_API_KEY` 环境变量是否正确设置
- 确认网络连接正常
- 验证API密钥是否有效

### 无法获取上下文
- 确保当前正在阅读有效内容
- 检查章节和段落索引是否正常

### 响应速度慢
- 网络延迟可能影响响应时间
- 复杂问题需要更多处理时间

## 技术实现

### 架构设计
- **ai_assistant.py**: Gemini API集成和上下文管理
- **reader.py**: 状态管理和命令处理
- **ui.py**: 全屏AI界面渲染
- **input_handler.py**: AI模式输入处理

### 设计模式
- 遵循现有TOC功能的全屏覆盖模式
- 异步处理AI API调用
- 状态驱动的UI更新机制

## 注意事项

1. **API费用**: 使用Gemini API可能产生费用，请注意使用量
2. **网络依赖**: AI功能需要稳定的网络连接
3. **隐私**: 您的问题和文本上下文会发送给Google Gemini API
4. **语言支持**: 主要支持中文交互，但也可以处理英文内容

## 快捷键总结

| 按键 | 功能 |
|------|------|
| `?` | 打开/关闭AI助手 |
| `Enter` | 发送问题 |
| `Esc` | 关闭AI助手 |
| `Ctrl+U` | 清空输入 |
| `q` | 退出程序 |

享受智能化的阅读体验！
